{% extends "base.html" %}
{% block title %}Pokoje – Hotel Aurora{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
    <div>
        <h2 class="mb-1"><i class="bi bi-door-open"></i> Lista pokoi</h2>
        <p class="text-muted mb-0">Zarządzaj pokojami hotelowymi</p>
    </div>
    {% if 'manager' in current_user.role|lower %}
    <a href="{{ url_for('rooms_add') }}" class="btn btn-success btn-lg">
        <i class="bi bi-plus-lg"></i> Dodaj pokój
    </a>
    {% endif %}
</div>

<div class="card shadow">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Nr pokoju</th>
                        <th>Typ</th>
                        <th>Cena/noc</th>
                        <th>Pojemność</th>
                        <th>Status</th>
                        <th>Akcje</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in rooms %}
                    <tr>
                        <td><span class="badge bg-info fs-6">{{ r['room_number'] }}</span></td>
                        <td class="text-capitalize">{{ r['room_type'] }}</td>
                        <td><strong>{{ r['price_per_night'] }} PLN</strong></td>
                        <td>
                            <i class="bi bi-person"></i> {{ r['capacity'] }}
                        </td>
                        <td>
                            {% if r['status'] == 'free' %}
                            <span class="badge bg-success">Wolny</span>
                            {% elif r['status'] == 'occupied' %}
                            <span class="badge bg-danger">Zajęty</span>
                            {% elif r['status'] == 'cleaning' %}
                            <span class="badge bg-warning">Sprzątanie</span>
                            {% elif r['status'] == 'maintenance' %}
                            <span class="badge bg-secondary">W remoncie</span>
                            {% else %}
                            <span class="badge bg-secondary">{{ r['status'] }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if 'manager' in current_user.role|lower %}
                            <div class="btn-group shadow-sm" role="group">
                                <a href="{{ url_for('rooms_edit', room_id=r['room_id']) }}"
                                    class="btn btn-sm btn-primary">
                                    <i class="bi bi-pencil"></i> Edytuj
                                </a>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-gear"></i> Status
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                                        <li>
                                            <h6 class="dropdown-header text-uppercase small ls-1">Zmień status</h6>
                                        </li>
                                        <li><a class="dropdown-item d-flex align-items-center gap-2 {% if r['status'] == 'free' %}active{% endif %}"
                                                href="{{ url_for('set_room_status', room_id=r['room_id'], status='free') }}">
                                                <i class="bi bi-check-circle text-success"></i> Wolny
                                            </a></li>
                                        <li><a class="dropdown-item d-flex align-items-center gap-2 {% if r['status'] == 'occupied' %}active{% endif %}"
                                                href="{{ url_for('set_room_status', room_id=r['room_id'], status='occupied') }}">
                                                <i class="bi bi-person-fill text-danger"></i> Zajęty
                                            </a></li>
                                        <li><a class="dropdown-item d-flex align-items-center gap-2 {% if r['status'] == 'cleaning' %}active{% endif %}"
                                                href="{{ url_for('set_room_status', room_id=r['room_id'], status='cleaning') }}">
                                                <i class="bi bi-brush text-warning"></i> Sprzątanie
                                            </a></li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>
                                        <li><a class="dropdown-item d-flex align-items-center gap-2 {% if r['status'] == 'maintenance' %}active{% endif %}"
                                                href="{{ url_for('set_room_status', room_id=r['room_id'], status='maintenance') }}">
                                                <i class="bi bi-tools text-secondary"></i> W remoncie
                                            </a></li>
                                    </ul>
                                </div>
                            </div>
                            {% endif %}
                        </td>

                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-5 text-muted">
                            <i class="bi bi-door-closed fs-1 d-block mb-2"></i>
                            Brak pokoi w bazie danych
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}